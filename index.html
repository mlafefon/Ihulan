<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>יוצר שערי מגזין</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Assistant:wght@400;700&family=David+Libre:wght@400;700&family=Frank+Ruhl+Libre:wght@400;700;900&family=Heebo:wght@400;700;900&family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>
<body class="bg-slate-900 text-white">
    <div class="min-h-screen bg-slate-900 flex flex-col lg:flex-row items-start justify-center p-4 lg:p-8 gap-8">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-full lg:w-96 bg-slate-800 p-6 rounded-lg shadow-lg flex flex-col space-y-6 self-start">
            <div>
                <h1 class="text-3xl font-bold text-white">יוצר שערי מגזין</h1>
                <p class="text-slate-400 mt-2">
                    עצבו את שער המגזין שלכם. לחצו על אלמנט כדי לבחור אותו, ולחצו שוב על טקסט כדי לערוך אותו ישירות.
                </p>
            </div>

            <div id="sidebar-content" class="hidden flex-grow overflow-y-auto pr-2 space-y-4 min-h-[200px]">
                <!-- Dynamic content for editor mode will be injected here -->
            </div>

            <div id="template-actions">
                 <div class="py-4 border-t border-b border-slate-700 space-y-4">
                    <div>
                        <label for="template-name-input" class="block text-sm font-medium text-slate-300 mb-1">שם התבנית</label>
                        <input type="text" id="template-name-input" class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2" placeholder="הכנס שם לתבנית...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">מידות (בפיקסלים)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="template-width-input" class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 text-center" placeholder="רוחב" title="רוחב">
                            <span class="text-slate-400 text-lg font-bold">x</span>
                            <input type="number" id="template-height-input" class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-2 text-center" placeholder="גובה" title="גובה">
                        </div>
                    </div>
                </div>

                <div class="py-4 border-b border-slate-700">
                     <p class="text-slate-400 mb-4">בחר אלמנט מהשער כדי לערוך אותו, או הוסף אלמנט חדש.</p>
                     <div class="space-y-3">
                        <div class="flex gap-3">
                            <button data-action="add-element" data-type="text" class="sidebar-btn bg-sky-600 hover:bg-sky-700 flex-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 24 24" fill="currentColor"><path d="M5 4h14a1 1 0 010 2h-6v13a1 1 0 01-2 0V6H5a1 1 0 110-2z"/></svg>
                                <span>הוסף טקסט</span>
                            </button>
                            <button data-action="add-element" data-type="image" class="sidebar-btn bg-sky-600 hover:bg-sky-700 flex-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                <span>הוסף תמונה</span>
                            </button>
                        </div>
                        <button data-action="add-element" data-type="clipping-shape" class="sidebar-btn bg-fuchsia-600 hover:bg-fuchsia-700">הוסף צורת חיתוך</button>
                    </div>
                </div>

                <div class="pt-4">
                     <button id="change-template-btn" class="sidebar-btn bg-blue-600 hover:bg-blue-700">
                        בחר תבנית
                    </button>
                </div>
            </div>

            <div class="pt-4 border-t border-slate-700">
                <div class="flex gap-3">
                    <button id="save-template-btn" class="sidebar-btn bg-green-600 hover:bg-green-700 flex-1">
                        שמור שינויים
                    </button>
                    <button id="export-template-btn" class="sidebar-btn bg-slate-600 hover:bg-slate-500 flex-1">
                        שמור כקובץ
                    </button>
                    <button id="export-image-btn" class="sidebar-btn bg-fuchsia-600 hover:bg-fuchsia-700 flex-1">
                        שמור כתמונה
                    </button>
                </div>
            </div>

             <input id="element-image-upload" type="file" accept="image/*" class="hidden" />

        </aside>

        <!-- Magazine Cover -->
        <main class="flex-1 flex items-center justify-center w-full">
            <div id="magazine-cover" class="w-full max-w-[700px] shadow-2xl mx-auto">
                <div id="cover-boundary" class="relative w-full h-full overflow-hidden bg-slate-700">
                    <!-- Cover content will be dynamically generated here -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- Template Selection Modal -->
    <div id="template-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="template-modal-title">
        <div id="template-modal-overlay" class="absolute inset-0"></div>
        <div class="bg-slate-800 rounded-lg shadow-xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col relative">
            <div class="flex justify-between items-center mb-4">
                <h2 id="template-modal-title" class="text-2xl font-bold text-white">בחר תבנית עיצוב</h2>
                <button id="modal-close-btn" class="modal-close-btn-style" aria-label="Close modal">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="template-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 overflow-y-auto p-2">
                <!-- Template previews will be injected here -->
            </div>
        </div>
    </div>

    <!-- Image Editor Modal -->
    <div id="image-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="image-editor-title">
        <div class="bg-slate-800 rounded-lg shadow-xl p-6 w-full max-w-6xl h-[95vh] max-h-[95vh] flex flex-col relative">
            <div class="flex justify-between items-center mb-4">
                <h2 id="image-editor-title" class="text-2xl font-bold text-white">עריכת תמונה</h2>
                <button id="image-editor-close-btn" class="modal-close-btn-style" aria-label="Close modal">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="flex-grow flex gap-6 min-h-0">
                <!-- Preview Area -->
                <div id="image-preview-container" class="flex-1 flex items-center justify-center bg-slate-900 rounded-md relative overflow-hidden">
                    <!-- This wrapper handles drag events and contains the image -->
                    <div id="image-preview-wrapper" class="absolute top-0 left-0 w-full h-full cursor-move">
                        <img id="image-preview-img" class="absolute top-0 left-0 pointer-events-none" style="transform-origin: 0 0;">
                    </div>
                    <!-- This canvas is for drawing the blur mask -->
                    <canvas id="blur-canvas" class="absolute pointer-events-none"></canvas>
                    <!-- This frame serves as the visual crop guide and mask overlay -->
                    <div id="image-preview-frame" class="absolute pointer-events-none"></div>
                </div>
                <!-- Controls -->
                <aside class="w-64 flex flex-col overflow-y-auto pr-2" id="image-editor-sidebar">
                    <div>
                        <h3 class="text-lg font-semibold text-slate-300">מידע</h3>
                        <p class="text-sm text-slate-400">רזולוציית מקור: <span id="source-res"></span></p>
                        <p class="text-sm text-slate-400">רזולוציית יעד: <span id="target-res"></span></p>
                    </div>
                    <div class="mt-4">
                        <label for="zoom-slider" class="block text-sm font-medium text-slate-300 mb-1">זום</label>
                        <input id="zoom-slider" type="range" min="1" max="3" step="0.01" value="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                    
                    <div id="image-editor-accordion-container" class="mt-4 pt-4 border-t border-slate-700 space-y-1">
                      <div class="accordion-group">
                        <button type="button" class="accordion-toggle" aria-expanded="false" aria-controls="filter-panel">
                          <svg class="accordion-chevron h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                          <span>פילטרים</span>
                        </button>
                        <div id="filter-panel" class="accordion-panel space-y-2">
                           <div>
                               <label for="brightness-slider" class="block text-sm font-medium text-slate-300 mb-1">בהירות</label>
                               <input id="brightness-slider" data-filter="brightness" type="range" min="0" max="200" value="100" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <div>
                               <label for="contrast-slider" class="block text-sm font-medium text-slate-300 mb-1">ניגודיות</label>
                               <input id="contrast-slider" data-filter="contrast" type="range" min="0" max="200" value="100" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <div>
                               <label for="saturation-slider" class="block text-sm font-medium text-slate-300 mb-1">רוויה</label>
                               <input id="saturation-slider" data-filter="saturation" type="range" min="0" max="200" value="100" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <div>
                               <label for="grayscale-slider" class="block text-sm font-medium text-slate-300 mb-1">גווני אפור</label>
                               <input id="grayscale-slider" data-filter="grayscale" type="range" min="0" max="100" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <div>
                               <label for="sepia-slider" class="block text-sm font-medium text-slate-300 mb-1">ספיה</label>
                               <input id="sepia-slider" data-filter="sepia" type="range" min="0" max="100" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <button id="reset-filters-btn" class="w-full mt-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors">איפוס פילטרים</button>
                        </div>
                      </div>

                      <div class="accordion-group pt-2 border-t border-slate-700">
                        <button type="button" class="accordion-toggle" aria-expanded="false" aria-controls="colorswap-panel">
                          <svg class="accordion-chevron h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                          <span>החלפת צבע</span>
                        </button>
                        <div id="colorswap-panel" class="accordion-panel space-y-3">
                           <p class="text-sm text-slate-400">לחץ על כפתור בחירת הצבע, ואז לחץ על צבעים בתמונה כדי להוסיף אותם להחלפה.</p>
                           <div class="flex items-start gap-3">
                               <div class="color-swap-box flex-1">
                                   <span class="color-swap-label">צבעי מקור (לחץ להסרה)</span>
                                    <div class="flex items-center gap-2 mt-1">
                                       <button id="pick-color-btn" class="color-swatch-btn flex-shrink-0" title="הוסף צבע מקור">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                       </button>
                                       <div id="source-colors-container" class="source-colors-container">
                                           <!-- Injected by JS -->
                                       </div>
                                    </div>
                               </div>
                               <div class="text-slate-500 text-xl font-light self-end pb-2">&larr;</div>
                               <div class="color-swap-box">
                                   <span class="color-swap-label">יעד</span>
                                   <label for="target-color-picker" class="color-swatch-btn" title="בחר צבע יעד">
                                        <div id="target-color-swatch" style="background-color: #ff0000;"></div>
                                   </label>
                                   <input type="color" id="target-color-picker" value="#ff0000" class="native-color-picker">
                               </div>
                           </div>
                           <div>
                               <label for="color-tolerance-slider" class="block text-sm font-medium text-slate-300 mb-1">רגישות: <span id="tolerance-value">20</span></label>
                               <input id="color-tolerance-slider" type="range" min="0" max="150" value="20" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                            <button id="reset-color-swap-btn" class="w-full mt-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors">איפוס החלפת צבע</button>
                        </div>
                      </div>

                      <div class="accordion-group pt-2 border-t border-slate-700">
                        <button type="button" class="accordion-toggle" aria-expanded="false" aria-controls="blur-panel">
                          <svg class="accordion-chevron h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                          <span>טשטוש</span>
                        </button>
                        <div id="blur-panel" class="accordion-panel space-y-4">
                           <p class="text-sm text-slate-400">סמן את האזור שיישאר חד. כל השאר יטושטש.</p>
                           <div>
                               <label for="brush-size-slider" class="block text-sm font-medium text-slate-300 mb-1">גודל מברשת: <span id="brush-size-value">20</span></label>
                               <input id="brush-size-slider" type="range" min="5" max="50" value="20" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                           </div>
                           <div class="grid grid-cols-2 gap-2">
                                <button id="mark-sharp-area-btn" class="sidebar-btn-icon bg-slate-600 hover:bg-slate-500" title="מברשת סימון">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                                </button>
                                <button id="erase-sharp-area-btn" class="sidebar-btn-icon bg-slate-600 hover:bg-slate-500" title="מחק">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                                </button>
                                <button id="apply-blur-btn" class="sidebar-btn-icon bg-green-600 hover:bg-green-700" title="בצע טשטוש">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                                </button>
                                <button id="reset-blur-btn" class="sidebar-btn-icon bg-red-600 hover:bg-red-700" title="איפוס טשטוש">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                </button>
                           </div>
                        </div>
                      </div>

                    </div>
                </aside>
            </div>
             <div class="flex-shrink-0 flex gap-3 pt-4 border-t border-slate-700 mt-4">
                <button id="replace-image-btn" class="sidebar-btn bg-sky-600 hover:bg-sky-700 flex-1">החלף תמונה</button>
                <button id="confirm-crop-btn" class="sidebar-btn bg-green-600 hover:bg-green-700 flex-1">אישור וחיתוך</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module" src="index.js"></script>
</body>
</html>